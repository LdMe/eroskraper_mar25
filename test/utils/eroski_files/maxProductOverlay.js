(function(){define(["jquery","common/layer/overlay","t5/core/ajax","common/basket/basketUpdater","common/zone/zoneUpdaterManager","common/loadingSpinner"],function(f,e,i,a,b,d){function l(m){return[{title:m.data("message-ok-title"),description:m.data("message-ok-description"),imageUri:m.data("message-ok-imguri")}]}function h(m){return[{title:m.data("message-ko")}]}function k(){e.setupCloseOverlayWhite();f(".overlay-max-product").find(".overlay-buttons .overlay-white-confirm").on("click",function(){i(f(this).parents(".overlay-max-product").data("url"),{success:function(){var x=f(".maxProductSpin");var v=f(".maxProductButton");var w=f(".maxProductListButton");if(w.length>0){var m=w;var s=m.data("checkPendingOrder");m.addClass("disable-button");d.showBodyLoading({element:m});var o=m.data("href");var n=m.data("zones").split(",");var r=b.updateZonesToRefresh(n);var p=l(m);var u=h(m);var y=window.location.pathname;i(o,{data:_.extend({messageOk:p[0].title,messageDescOk:p[0].description,uriImg:p[0].imageUri,listPosition:m.data("index"),listSize:m.data("total"),currentUrl:y,checkUnavailable:true,checkedPendingOrder:s},r),success:function(){d.hideBodyLoading();if(f(".overlay-unavailable-products.overlay-content").is(":hidden")){notificator.addNotification(p,true)}},failure:function(){d.hideBodyLoading();if(f(".overlay-unavailable-products.overlay-content").is(":hidden")){notificator.addNotification(u)}},complete:function(){g()}});return}if(v.length){if(x.data("showProductNotes")==="true"){c(x.data("product"))}}var q=f("."+v.parent().find(".quantity-add-option").attr("class").replace(/ /g,"."));var t=1;if(q.data("min-quantity")>0){t=q.data("min-quantity")}q.each(function(){f(this).data("previous-quantity",t);f(this).show();f(this).closest(".add-product-btn").find("a").first().hide();f(this).find(".quantity").val(t);f(this).closest("form").find(".update").css("display","inline-block");f(this).closest(".input-group").css("display","inline-block");f(this).closest(".selector-drag").show()});v.parent().find(".quantity.quantity-add-option").data("old-quantity",t);a.updateProduct(j(q,t,t))},complete:function(){g()}})})}function g(){f(".maxProductSpin").removeClass("maxProductSpin");f(".maxProductButton").removeClass("maxProductButton");f(".maxProductListButton").removeClass("maxProductListButton");e.closeOverlay()}function c(m){var n=f("."+m+"q");f(".product-options-detail").not(n.closest(".add-product").find(".product-options-detail")).fadeOut();n.closest(".add-product").find(".product-options-detail").fadeToggle()}function j(t,p,v){var n={title:p<0?t.data("message-subtract"):t.data("message-add"),imageUri:t.data("product-img")};if(v>0){n.description=v+" "+t.data("message-desc")}var o=t.data("product");var r=t.data("shopRef");var m=t.parent().parent().find("input[type=radio]:checked").val();var q=t.parent().parent().find("select[id=quantitySelector]").val();if(v>0){var u="Uds";if(m==="weight"){var s=q.split(" ");u=s[1]}n.description=v+" "+u+" "+t.data("message-desc")}return{ref:o,shopRef:r,quantity:p,totalQuantity:v,weight:q,selectionType:m,notification:n,failure:function(){var w=f("."+o+"q");w.each(function(){var x=f(this).data("previous-quantity");f(this).val(f(this).val()-p);f(this).data("previous-quantity",f(this).data("previous-quantity")-p);if(x==0){f(this).val(f(this).val()-1);f(this).parents(".add-product .add-product-btn").find("a").hide();f(this).parents(".input-group").show();f(this).closest(".add-product-btn").find(".update").show()}else{if(f(this).val()==0){if(f(this).hasClass("quantity-add-option")){resetButtons(f(this));f(this).parents(".input-group").hide();f(this).val(1)}else{if(!f(this).hasClass("quantity-add-option")){f(this).val(1)}}}}f(this).data("old-quantity",f(this).val())})}}}return{init:k}})}).call(this);