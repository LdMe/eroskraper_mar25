(function(){define(["jquery","components/layer/basketNotificator","common/zone/zoneUpdaterManager","t5/core/ajax","common/tooltip","common/loadingSpinner","common/layer/overlay","common/config/device","common/scroll/customScroll"],function(f,d,a,k,n,c,e,b,i){var h;function m(r,q,p,o){h=p;f(".nextOrderList-overlay").hide();if(o){setTimeout(function(){f(".quick-purchase-aside").css("z-index",99999)},1)}f(".confirm-unavailable-products").unbind("click").on("click",function(A){if(A){A.preventDefault()}var u;if(r!==""){u=f("a.add-order-button-"+r)}if(q!==""){u=f("a.add-shoppinglist-button-"+q)}if(!u||u.length==0){u=f("a.add-shoppinglist-button-")}u.addClass("disable-button");f(".confirm-unavailable-products").addClass("disable-button");c.showBodyLoading({element:u});var w=u.data("href");var v=u.data("zones").split(",");var y=a.updateZonesToRefresh(v);var x=l(u);var z=j(u);var B=window.location.pathname;var t=u.siblings(".unavailable-products-zone-overlay").find(".unavailable-product-references").data("product-refs");f(".nextOrderList-overlay").hide();k(w,{data:_.extend({messageOk:x[0].title,messageDescOk:x[0].description,basketType:u.data("basket-type"),uriImg:x[0].imageUri,listPosition:u.data("index"),listSize:u.data("total"),currentUrl:B,excludedRefs:t,checkUnavailable:false,checkedPendingOrder:true,action:"MERGE"},y),success:function(){c.hideBodyLoading();d.addNotification(x);e.closeOverlay()},failure:function(){c.hideBodyLoading();d.addNotification(z);e.closeOverlay()}})});f(".dont-show-unavailable").unbind("click").on("click",function(t){f(this).addClass("disable-button");c.showBodyLoading({element:f(this)});k(h,{success:function(){f(".purchasing-process-item.shopping-cart").removeClass("cartalert-icon");c.hideBodyLoading();e.closeOverlay();setTimeout(function(){f(".quick-purchase-aside").css("z-index","")},1);f(".refresh-unavailable-products-zones").each(function(v,w){var u=f(w).data("update-url");k(u,{success:function(){},failure:function(){}})})}})});f(".cancel-unavailable-products-overlay").unbind("click").on("click",function(t){if(t){t.preventDefault()}g(r,q);e.closeOverlay();setTimeout(function(){f(".quick-purchase-aside").css("z-index","")},1)});f(window).click(function(t){if(f(".overlay-content").is(":visible")&&!f(t.target).closest(".overlay-content").length){g(r,q);e.closeOverlay();setTimeout(function(){f(".quick-purchase-aside").css("z-index","")},1)}});if(b.isMobile()){var s={cursorcolor:"#D8D8D8",cursorwidth:"10px"};f("#overlay-unavailable-products .overlay-content").niceScroll(s)}else{var s={cursorcolor:"#D8D8D8",cursorwidth:"10px"};f(".removed_items").niceScroll(s)}}function g(p,o){if(p!==""){f("a.add-order-button-"+p).removeClass("disable-button")}if(o!==""){f("a.add-shoppinglist-button-"+o).removeClass("disable-button")}f("a.add-shoppinglist-button-").removeClass("disable-button");f(".logged-button.my-list-button.logged-button-with-link.logged-button-active").removeClass("logged-button-active");f(".logged-button.last-order-button.logged-button-with-link.logged-button-active").removeClass("logged-button-active")}function l(o){return[{title:o.data("message-ok-title"),description:o.data("message-ok-description"),imageUri:o.data("message-ok-imguri")}]}function j(o){return[{title:o.data("message-ko")}]}return{init:m}})}).call(this);