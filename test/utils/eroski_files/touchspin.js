(function(){define(["jquery","common/basket/basketUpdater","t5/core/ajax","common/layer/overlay","common/config/device"],function(c,i,h,w,s){function g(I,D,M,E){var B={title:D<0?I.attr("data-message-subtract"):I.attr("data-message-add"),imageUri:I.attr("data-product-img")};var L=c(c(".price-offer-before")[0]).closest(".product-item");L.find(".bootstrap-touchspin-up").addClass("btnMasAutoIdOferta");L.find(".bootstrap-touchspin-down").addClass("btnMenosAutoIdOferta");L.find(".update.toUpdate").addClass("btnUpdateAutoIdOferta");var C=I.closest(".productWrapper").find('input[type="checkbox"][id^="pickUp"]');var K=false;if(C.length>0&&C.is(":checked")){K=true}var z=I.parent().parent().find("input[type=radio]:checked").val();var G=I.closest("form").find("option:selected").first().text();if(M>=0){var J=I.attr("data-message-units");if(M==1){J=I.attr("data-message-unit")}if(z==="weight"){if(D==0){B.title=I.attr("data-message-change-type-weight")}B.description=G+" "+I.attr("data-message-desc")}else{if(D==0){B.title=I.attr("data-message-change-type-units")}B.description=M+" "+J+" "+I.attr("data-message-desc")}}var A=I.attr("data-product");var F=I.attr("data-offer-id");var H=I.attr("data-shop-ref");return{ref:A,offerId:F,shopRef:H,quantity:D,notification:B,weight:G,selectionType:z,totalQuantity:M,productUnitsPerPack:E,pickUpVal:K,failure:function(){var O=A;if(F){O=O+"-"+F}var N=c("."+O+"q");N.each(function(){var P=c(this).attr("data-previous-quantity");c(this).val(c(this).val()-D);c(this).attr("data-previous-quantity",c(this).attr("data-previous-quantity")-D);if(P==0){c(this).val(c(this).val()-1);c(this).parents(".add-product .add-product-btn").find("a").css("display","none");c(this).parents(".input-group").css("display","inline-block");c(this).closest(".add-product-btn").find(".update").css("display","inline-block")}else{if(c(this).val()<=0){if(c(this).hasClass("quantity-add-option")){e(c(this));c(this).parents(".input-group").hide();c(this).val(c(this).attr("data-min-quantity"))}else{if(!c(this).hasClass("quantity-add-option")){c(this).val(c(this).attr("data-min-quantity"))}}}}c(this).attr("data-old-quantity",c(this).val())})}}}function b(A,B,C,z){A.TouchSpin({booster:true,boostat:20,initval:C,minGranel:C,max:B,step:z})}function k(C,z,B,A){C.closest(".input-group").hide();C.closest(".add-product").find(".add-product-btn update").first().hide();C.closest(".touchpin-product-cart .input-group").css("display","inline-block");C.closest(".add-product").find(".add-product-btn a.available-btn").first().on("click",function(F){if(F){F.preventDefault()}if(c(".item-shopping-cart-summary-description").length>=B&&c(".delivery-type-holder").length>0&&c(c(".delivery-type-holder")[0]).attr("data-deliverytype")==="QUICK_DELIVERY"){w.setOverlayWhite(c("#overlay-max-product"));c(this).addClass("maxProductButton");C.addClass("maxProductSpin");C.attr("data-showProductNotes",z);return false}if(C.closest(".add-product-btn").find(".selection-type").length>0){if(C.closest(".add-product-btn").find(".selection-type:checked").length==0){w.setOverlayWhite(c("#overlay-alert-selection"));return false}}if(z){var E=C.attr("data-product");var D=C.attr("data-offer-id");if(D){E=E+"-"+D}y(E)}C.attr("data-last-radio-pressed",C.closest(".add-product-btn").find("input[type=radio]:checked").val());var H=c("."+c(this).parent().find(".quantity-add-option").attr("class").replace(/ /g,"."));var G=1;if(H.attr("data-min-quantity")>0){G=H.attr("data-min-quantity")}H.each(function(){c(this).attr("data-previous-quantity",G);c(this).show();c(this).closest(".add-product-btn").find("a").first().hide();c(this).find(".quantity").val(G);c(this).closest("form").find(".update").css("display","inline-block");c(this).closest(".input-group").css("display","inline-block");var L=c(this).attr("data-product");var K=c(this).attr("data-offerId");var J="#item-minibasket-"+L;if(K){J=J+"-"+K}var I=c(J).find(".quantity").attr("data-previous-quantity");if(I==null){I=G}else{I=parseInt(I)+parseInt(G)}c(this).val(I);c(this).closest(".selector-drag").show();c(this).closest(".add-product-btn").find("input.select-dropdown").text(G);var M=c(this).closest(".add-product-btn").find("option[value="+G+"]").text();c(this).closest(".add-product-btn").find("input.select-dropdown").val(M);c(this).closest("form").find("select").val(G).change()});c(this).parent().find(".quantity.quantity-add-option").attr("data-old-quantity",G);i.updateProduct(g(H,G,G,A))})}function j(){var z=c(".product-options-detail").find(".notes-input").val();c(".button.primary-button.close-product").off().on("click",function(A){if(A){A.preventDefault()}c(".product-options-detail").find(".notes-input").val(z);c(this).closest(".product-options-detail").fadeOut()});c(".product-options-detail .button.secondary-button").off().on("click",function(B){if(B){B.preventDefault()}var A=c(this).closest(".product-options-detail").find(".notes-input");z=A.val();A.attr("data-actualnote",A.val());c(this).closest(".product-options-detail").fadeOut()})}function l(A,B,z,F,C,D,E){A.closest("form").on("submit",function(G){if(G){G.preventDefault()}return false});A.on("focus",function(){c(this).val("");var H=c(this).parents(".add-product .add-product-btn").find(".quantity.quantity-add-option");var G=c("."+H.attr("class").replace(/ /g,"."));G.each(function(){c(this).parents(".input-group").addClass("backMode")});c(this).closest(".input-group").find(".back").off().on("click",function(){G.each(function(){c(this).parents(".add-product .add-product-btn").find(".update").text(A.attr("data-message-added"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate");c(this).parents(".input-group").removeClass("backMode")});n(G,H.attr("data-previous-quantity"),false,C)})});A.on("change textInput input",function(){var M=c(this).val();const I=new RegExp("^[0-9]+$");if(M!=""&&!I.test(M)){c(this).val(A.attr("data-previous-quantity"));return false}var G=c("."+c(this).attr("class").replace(/ /g,"."));a(c(this).parent().siblings(".units_text").find("span"),M);var H=A.attr("data-last-radio-pressed");var L=false;if(H){L=true}if(c(".product-limit").length>0){c(".product-limit").remove()}if(M>B-1){if(D){c(this).closest(".add-product").prepend("<div class='product-limit'><span class='remove-limit'></span> <p>"+E+"</p></div>")}else{c(this).closest(".add-product").prepend("<div class='product-limit'><span class='remove-limit'></span> <p>"+z+"<strong> "+B+"</strong></p></div>")}c(".remove-limit").on("click",function(){c(this).closest(".product-limit").remove()})}else{if(M<C&&M>=0&&L&&C>1){c(this).closest(".add-product").prepend("<div class='product-limit'><span class='remove-limit'></span> <p>"+F+"</p></div>");c(".remove-limit").on("click",function(){c(this).closest(".product-limit").remove()})}}var J=A.attr("data-last-radio-submitted");var K=A.attr("data-previous-quantity");if(M.length===0){}else{if(M<C){if(M==0){c(this).parents(".add-product .add-product-btn").find(".update").text(G.attr("data-message-update"));c(this).parents(".add-product .add-product-btn").find(".update").addClass("toUpdate")}else{if(J==H){c(this).parents(".add-product .add-product-btn").find(".update").text(A.attr("data-message-added"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate")}}n(G,M,true,C)}else{if((J==H&&M==K)||(!L&&M==K)){c(this).parents(".add-product .add-product-btn").find(".update").text(A.attr("data-message-added"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate");if(L){n(G,M,M!=A.attr("data-previous-quantity"),C)}}else{c(this).parents(".add-product .add-product-btn").find(".update").text(G.attr("data-message-update"));c(this).parents(".add-product .add-product-btn").find(".update").addClass("toUpdate");n(G,M,M!=A.attr("data-previous-quantity"),C)}}}});A.on("focusout",function(){var H=c(this).val();if(H.length===0){var G=c(this).attr("data-previous-quantity");c(this).val(c(this).attr("data-previous-quantity"));c(this).parents(".add-product .add-product-btn").find(".update").text(c(this).attr("data-message-added"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate")}})}function n(z,D,B,C){var A=0;z.each(function(){A=A+c(this).closest('[id^="item-minibasket-"]').length});var E=0;z.each(function(){if(A>1){if(this.parentNode.parentNode.parentNode.id.startsWith("item-minibasket-")){E=parseInt(E)+parseInt(c(this).val())}else{c(this).val(E);c(this).parents(".add-product .add-product-btn").find(".update").text(z.attr("data-message-update"));c(this).parents(".add-product .add-product-btn").find(".update").addClass("toUpdate")}}else{if(!isNaN(parseInt(D))){if(D<C){}else{c(this).val(D);c(this).attr("data-last-value",D);c(this).closest(".add-product-btn.added-to-cart").find("ul.select-dropdown li").removeClass("active")}var J=c(this).closest(".add-product-btn").find("option[value="+D+"]").text()}if(B){var G=c(this).attr("data-last-radio-pressed");var H=c(this).attr("data-last-radio-submitted");var F=c(this).closest(".add-product-btn").find(".quantity-add-option").val();if(F!=D){c(this).closest(".add-product-btn").find(".quantity-add-option").val(D)}var I=c(this).attr("data-previous-quantity");if(H==G&&D==I){c(this).parents(".add-product .add-product-btn").find(".update").text(c(this).attr("data-message-added"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate")}else{c(this).parents(".add-product .add-product-btn").find(".update").text(z.attr("data-message-update"));c(this).parents(".add-product .add-product-btn").find(".update").addClass("toUpdate")}a(c(this).parent().siblings(".units_text").find("span"),D)}else{var G=c(this).attr("data-last-radio-pressed");var H=c(this).attr("data-last-radio-submitted");if(H==G){c(this).parents(".add-product .add-product-btn").find(".update").text(c(this).attr("data-message-added"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate")}else{c(this).parents(".add-product .add-product-btn").find(".update").text(c(this).attr("data-message-update"));c(this).parents(".add-product .add-product-btn").find(".update").addClass("toUpdate")}}}})}function m(A,z){A.closest(".input-group").after("<a class='update' rel='nofollow'>"+A.attr("data-message-added")+"</a>");A.closest(".input-group").prepend("<a class='back' rel='nofollow' title='"+A.attr("data-message-cancel")+"' alt='"+A.attr("data-message-cancel")+"'></a>");if(A.parents(".add-product-btn").first().hasClass("touchpin-product-cart")){A.parents(".add-product .add-product-btn").find(".update").css("display","inline-block")}A.parents(".add-product .add-product-btn").find(".update").click(function(){if(c(this).hasClass("toUpdate")){var G=c(this).parents(".add-product .add-product-btn").find(".quantity.quantity-add-option");var E=parseInt(G.val());G.val(E);var C=A.closest(".add-product-btn").find("input[type=radio]:checked").val();if(E==0){A.closest(".add-product-btn").find("input.form-control").attr("data-last-radio-pressed","");A.closest(".add-product-btn").find("input.form-control").attr("data-last-radio-submitted","")}else{A.closest(".add-product-btn").find("input.form-control").attr("data-last-radio-pressed",C)}if(C=="units"){A.closest(".add-product-btn").find("input.select-dropdown").text(E);var F=A.closest(".add-product-btn").find("option[value="+E+"]").text();A.closest(".add-product-btn").find("input.select-dropdown").val(F);A.closest("form").find("select").val(E).change()}var D=E-G.attr("data-previous-quantity");var B=c("."+G.attr("class").replace(/ /g,"."));B.each(function(){c(this).parents(".add-product .add-product-btn").find(".update").text(c(this).attr("data-message-added"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate");c(this).parents(".add-product .add-product-btn").find(".input-group").removeClass("backMode");c(this).attr("data-previous-quantity",E);if(c(this).val()==0){if(c(this).hasClass("quantity-add-option")){e(c(this));c(this).parents(".input-group").hide();c(this).val(c(this).attr("data-min-quantity"));c(this).parents(".add-product .add-product-btn").find(".update").removeClass("toUpdate");c(this).parents(".add-product .add-product-btn").find(".update").text(c(this).attr("data-message-added"))}else{if(!c(this).hasClass("quantity-add-option")){c(this).val(c(this).attr("data-min-quantity"))}}}});c(this).parent().find(".quantity.quantity-add-option").attr("data-old-quantity",D);i.updateProduct(g(G,D,E,z))}})}function u(z){e(z);if(z.hasClass("quantity-add-option")){z.parents(".input-group").hide();z.val(z.attr("data-min-quantity"));z.attr("data-previous-quantity",1)}}function e(z){z.parents(".add-product .add-product-btn").find("a").not(".update, .back").css("display","inline-block");z.parents(".add-product .add-product-btn").find(".update").hide()}function v(A){var z=c("."+A+"q");u(z)}function f(){c(".quantity-add-option:visible, #productListZone .input-field.combo.quantities-combo:visible").each(function(){u(c(this))})}function a(z,B){if(z){var A=z.attr("data-prural");if(B==1){A=z.attr("data-singular")}z.text(A)}}function r(z){var B=c("#"+z);var A=B.attr("data-last-radio-pressed");B.attr("data-last-radio-submitted",A)}function x(B,z){var A=z.split("-");if(c("#item-minibasket-"+A[2]).length>0||c("#item-basket-"+A[2]).length>0||(A.length==4&&(c("#item-minibasket-"+A[2]+"-"+A[3]).length>0||c("#item-basket-"+A[2]+"-"+A[3]).length>0))){if(B.closest(".add-product-btn").find("input.selection-type.units").attr("checked")){B.attr("data-last-radio-pressed","units");B.attr("data-last-radio-submitted","units")}else{if(B.closest(".add-product-btn").find("input.selection-type.weight").attr("checked")){B.attr("data-last-radio-pressed","weight");B.attr("data-last-radio-submitted","weight")}}}}function q(A){var z;if(A.length==4){z=["item-minibasket-"+A[2]+"-"+A[3],"item-list-"+A[2]+"-"+A[3],"item-detail-"+A[2]+"-"+A[3],"item-basket-"+A[2]+"-"+A[3],"item-quickpurchase-"+A[2]+"-"+A[3],"item-scrollpanel-"+A[2]+"-"+A[3]]}else{z=["item-minibasket-"+A[2],"item-list-"+A[2],"item-detail-"+A[2],"item-basket-"+A[2],"item-quickpurchase-"+A[2],"item-scrollpanel-"+A[2]]}var B=0;do{if(c("#"+z[B]).length>0){return z[B]}B++}while(B<z.length);return null}function p(E){var G=E.closest("div.add-product-btn").attr("id");if(G.includes("item-suggestion")){var H=G.split("-");var D=q(H);if(c("#"+D).length){var A=c("#"+D).find("input.form-control").attr("data-last-radio-submitted");var F=c("#"+D).find("a.update").text();c("#"+G).find("a.update").text(F);if(c("#"+D).find("a.update").hasClass("toUpdate")){c("#"+G).find("a.update").addClass("toUpdate")}var z=E.parent().parent().find("input[type=radio]:checked").val();if(c("#"+D).find("input[type=radio]:checked").val()=="units"){E.attr("data-last-radio-pressed","units");E.attr("data-last-radio-submitted",A);c("#"+G+"_unidades").prop("checked","true")}else{if(c("#"+D).find("input[type=radio]:checked").val()=="weight"){E.attr("data-last-radio-pressed","weight");E.attr("data-last-radio-submitted",A);c("#"+G+"_peso").prop("checked","true")}}var B=c("#"+D).find("input.form-control");var C=B.val();E.val(C);var I=E.closest(".add-product-btn").find("option[value="+C+"]").text();E.closest(".add-product-btn").find("input.select-dropdown").text(C);E.closest(".add-product-btn").find("input.select-dropdown").val(I);E.closest("form").find("select").val(C).change()}}}function t(K,z,B,E,A,H,D,C,J,L){var G=c("#"+K);var I=G.closest("div.add-product-btn").attr("id");if(I.includes("minibasket")||I.includes("suggestion")&&s.isDesktop()){var F=c("#"+I).find(".dropdown-content");setTimeout(function(){if(F.length){var M={cursorcolor:"#686868",cursorwidth:"10px",railvalign:"top"};F.niceScroll(M)}},200);c(".shopping-cart-summary-scroll").scroll(function(){c(".shopping-cart-summary-scroll .dropdown-content.select-dropdown.active").getNiceScroll().resize()})}x(G,I);b(G,B,E,C);setTimeout(function(){var M=G.closest("div.add-product-btn").find("input.select-dropdown");c("<div class='close_select-dropdown'></div>").insertAfter(M)},5);k(G,z,D,C);l(G,B,A,H,E,J,L);m(G,C);j();a(G.parent().siblings(".units_text").find("span"),G.val());if(G.attr("data-zones")){i.init(G.attr("data-action"),G.attr("data-zones").split(","))}G.on("touchspin.on.stopspin",function(){var N=G.attr("data-last-radio-pressed");var O=false;if(N){O=true}var M=G.closest(".add-product-btn").find(".quantity-add-option").val();if(M==0&&O&&E>1){G.closest(".add-product").prepend("<div class='product-limit'><span class='remove-limit'></span> <p>"+H+"</p></div>");c(".remove-limit").on("click",function(){c(".remove-limit").closest(".product-limit").remove()})}else{if(c(".product-limit").length>0){if(M>B-1){}else{c(".product-limit").remove()}}}});G.closest(".add-product-btn").find("input.selection-type.units").click(function(){var M=c(this).closest("div.add-product-btn").attr("id");var N=M.split("-");console.log("productRef:"+N[2]);var Q=G.attr("data-last-radio-submitted");G.attr("data-last-radio-pressed","units");var O;if(N.length==4){O=["item-minibasket-"+N[2]+"-"+N[3],"item-list-"+N[2]+"-"+N[3],"item-detail-"+N[2]+"-"+N[3],"item-basket-"+N[2]+"-"+N[3],"item-quickpurchase-"+N[2]+"-"+N[3],"item-scrollpanel-"+N[2]+"-"+N[3]]}else{O=["item-minibasket-"+N[2],"item-list-"+N[2],"item-detail-"+N[2],"item-basket-"+N[2],"item-quickpurchase-"+N[2],"item-scrollpanel-"+N[2]]}var P=0;do{if(c("#"+O[P]).length>0){c("#"+O[P]+"_unidades").prop("checked","true");d(Q,O[P],"units")}P++}while(P<O.length)});G.closest(".add-product-btn").find("input.selection-type.weight").click(function(){var M=c(this).closest("div.add-product-btn").attr("id");var N=M.split("-");console.log("productRef:"+N[2]);var R=G.val();c("#"+M).find("input.select-dropdown").text(R);var S=G.closest(".add-product-btn").find("option[value="+R+"]").text();G.closest(".add-product-btn").find("input.select-dropdown").val(S);G.closest("form").find("select").val(R).change();var Q=G.attr("data-last-radio-submitted");G.attr("data-last-radio-pressed","weight");var O;if(N.length==4){O=["item-minibasket-"+N[2]+"-"+N[3],"item-list-"+N[2]+"-"+N[3],"item-detail-"+N[2]+"-"+N[3],"item-basket-"+N[2]+"-"+N[3],"item-quickpurchase-"+N[2]+"-"+N[3],"item-scrollpanel-"+N[2]+"-"+N[3]]}else{O=["item-minibasket-"+N[2],"item-list-"+N[2],"item-detail-"+N[2],"item-basket-"+N[2],"item-quickpurchase-"+N[2],"item-scrollpanel-"+N[2]]}var P=0;do{if(c("#"+O[P]).length>0){c("#"+O[P]+"_peso").prop("checked","true");d(Q,O[P],"weight",R)}P++}while(P<O.length)});G.closest(".add-product-btn").find("a.update").click(function(){c("#"+K).closest("div.add-product-btn").parent().find("div.product-limit").remove();r(K)});G.closest(".add-product-btn").parent().find("a.available-btn").click(function(){r(K)});p(G)}function d(B,G,E,z){var H=c("#"+G).find("input.form-control");c("#"+G).find("input.select-dropdown").text(z);var I=H.closest(".add-product-btn").find("option[value="+z+"]").text();H.closest(".add-product-btn").find("input.select-dropdown").val(I);H.closest("form").find("select").val(z).change();H.attr("data-last-radio-pressed",E);if(B){if(B==E){var D=H.closest(".add-product-btn").find(".quantity-add-option").val();var A=H.attr("data-previous-quantity");if(D==A){var F=H.attr("data-message-added");H.closest(".add-product-btn").find(".update").text(F);H.closest(".add-product-btn").find(".update").removeClass("toUpdate")}}else{var C=H.attr("data-message-update");H.closest(".add-product-btn").find(".update").text(C);H.closest(".add-product-btn").find(".update").addClass("toUpdate")}H.attr("data-last-radio-submitted",B)}}function y(z){var A=c("."+z+"q");c(".product-options-detail").not(A.closest(".add-product").find(".product-options-detail")).fadeOut();A.closest(".add-product").find(".product-options-detail").fadeToggle()}function o(){var z={};c('div[id^="item-minibasket-"] input[id^="addToCart_"]').each(function(){var F=c(this).data("product");var E=c(this).data("offer-id");if(E){F=F+"-"+E}var D=c(this).data("previous-quantity");if(z.hasOwnProperty(F)){z[F]=z[F]+parseInt(D)}else{z[F]=parseInt(D)}});for(ref in z){var C=z[ref];var A=c('div[id^="item-list-"] input[id^="addToCart_"].'+ref+"q");A.data("previous-quantity",C);A.val(C);var B=c('div[id^="item-detail-'+ref+'"] input[id^="addToCart_"]');B.data("previous-quantity",C);B.val(C)}}return{init:t,resetTouchspin:v,resetAllTouchspinActive:f,registerRadioSelected:r,updateMosaic:o}})}).call(this);