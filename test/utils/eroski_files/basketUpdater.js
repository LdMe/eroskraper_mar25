(function(){define(["components/layer/basketNotificator","common/zone/zoneUpdaterManager","t5/core/ajax","underscore","jquery.nicescroll"],function(b,n,j,q){var d=false;var o=true;var k=false;var c="";var a=[];var i=[];var e;var p;function f(){var s;if(k){s=q.map(i,function(t){var u=t.notification;u.title="";u.description=c;return u})}else{s=q.map(i,function(t){return t.notification})}s.error=k;b.addNotification(s,true)}function h(){f();r();i=[];if(q.isEmpty(a)){o=true}else{m()}}var g=function(s){g(s,false)};var g=function(w,s){var t=q.indexBy(a,"ref");if(q.isUndefined(t[w.ref])){a.push(w)}else{var v=t[w.ref];var u=v.quantity*1;var x=w.quantity*1;u+=x;v.quantity=u}if(o){o=false;m(s)}};function m(u){i=q.clone(a);a=[];var s=q.map(i,function(v){return q.pick(v,"ref","shopRef","offerId","quantity","weight","selectionType","totalQuantity","productUnitsPerPack","pickUpVal")});var t=n.updateZonesToRefresh(p);j(e,{data:q.extend({products:JSON.stringify(s),checkedPendingOrder:u},t),success:function(){k=false;for(var v=0;v<i.length;v++){i[v].success&&i[v].success()}h()},failure:function(v){k=true;var w=v.header("X-Tapestry-ErrorMessage");c=q.isEmpty(w)?"Se ha producido un error":w;for(var x=0;x<i.length;x++){i[x].failure&&i[x].failure()}h()}})}function r(){if($(".shopping-cart-summary-scroll").getNiceScroll().length==0){var s={cursorcolor:"#D8D8D8",cursorwidth:"10px"};$(".shopping-cart-summary-scroll").niceScroll(s)}setTimeout(function(){$(".shopping-cart-summary-scroll").getNiceScroll().resize()},10)}var l=function(t,s){if(d===false){e=t;p=s;d=true}};return{init:l,updateProduct:g}})}).call(this);